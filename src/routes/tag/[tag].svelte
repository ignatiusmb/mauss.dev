<script context="module">
  export async function preload({ params }) {
    let list = await this.fetch('posts.json').then(r => r.json());
    const data = list.filter(post => post.tags.includes(params.tag));
    if (!data.length) return this.error(404, `${params.tag} not found anywhere`);
    return { data, tag: params.tag };
  }
</script>

<script>
  export let data, tag;
  import MetaHead from '../../components/MetaHead.svelte';
  import TagCard from '../../components/TagCard.svelte';
  import Button from '../../components/Button.svelte';

  import { capitalize, isAbbreviated } from '../../utils/helper';
  tag = isAbbreviated(tag) ? tag.toUpperCase() : capitalize(tag);
</script>

<MetaHead title="Tagged with {tag}" description="All articles tagged with {tag}" />

<header>
  <h1>{tag}</h1>
</header>

<article>
  {#each data as post, idx}
    <TagCard {post} time={600 + 100 * idx}>
      <Button href="posts/{post.slug}">read</Button>
    </TagCard>
  {/each}

</article>

<style>
  header {
    width: 75em;
    max-width: 92%;
    padding: calc(1.4vw + 0.5em) 0px;
    border: 2px solid var(--bg-inverse);
    border-radius: 0.15em;
    box-shadow: 5px 6px 0px var(--bg-inverse);
    margin: 1.5em auto;
  }
  header h1 {
    text-align: center;
  }

  article {
    display: grid;
    gap: 1em;
    grid-template-columns: 1fr;
    justify-content: center;
    width: 100%;
    max-width: 64em;
    padding: 0 1em;
    margin: 1em auto;
  }
</style>
